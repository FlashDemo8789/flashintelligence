<!DOCTYPE html>
<html>
<head>
    <title>Test JARVIS Flash AI</title>
    <style>
        body {
            font-family: -apple-system, sans-serif;
            padding: 20px;
            background: #000;
            color: #fff;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #333;
            border-radius: 10px;
        }
        .status { color: #0ff; }
        .error { color: #f00; }
        .success { color: #0f0; }
        button {
            background: #0ff;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        #log {
            background: #111;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Flash AI JARVIS Test Page</h1>
    
    <div class="test-section">
        <h2>1. API Key Status</h2>
        <p id="api-status" class="status">Checking...</p>
        <button onclick="checkAPIKey()">Check API Key</button>
        <button onclick="setTestAPIKey()">Set Test API Key</button>
    </div>
    
    <div class="test-section">
        <h2>2. Voice Recognition Test</h2>
        <p id="voice-status" class="status">Checking...</p>
        <button onclick="testVoiceRecognition()">Test Voice Recognition</button>
        <button onclick="testSpeechSynthesis()">Test Speech Output</button>
    </div>
    
    <div class="test-section">
        <h2>3. Groq API Test</h2>
        <p id="groq-status" class="status">Ready to test</p>
        <button onclick="testGroqAPI()">Test Groq API</button>
    </div>
    
    <div class="test-section">
        <h2>4. Full Integration Test</h2>
        <button onclick="window.open('index.html', '_blank')">Open FlashIntelligence</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <div class="test-section">
        <h2>Console Log</h2>
        <div id="log"></div>
    </div>

    <script src="config.js"></script>
    <script>
        function log(message, type = 'info') {
            const logEl = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f00' : type === 'success' ? '#0f0' : '#fff';
            logEl.innerHTML += `<div style="color: ${color}">[${time}] ${message}</div>`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(message);
        }
        
        function checkAPIKey() {
            const apiKey = localStorage.getItem('GROQ_API_KEY');
            const statusEl = document.getElementById('api-status');
            
            if (apiKey && apiKey !== 'YOUR_GROQ_API_KEY_HERE') {
                statusEl.className = 'success';
                statusEl.textContent = `API Key is set: ${apiKey.substring(0, 10)}...`;
                log('API Key found in localStorage', 'success');
            } else {
                statusEl.className = 'error';
                statusEl.textContent = 'No API Key found';
                log('No API Key found. Please set it.', 'error');
            }
        }
        
        function setTestAPIKey() {
            // Prompt for API key
            const apiKey = prompt('Enter your Groq API key:');
            if (apiKey) {
                localStorage.setItem('GROQ_API_KEY', apiKey);
                log('API Key set in localStorage', 'success');
                checkAPIKey();
            }
        }
        
        function testVoiceRecognition() {
            const statusEl = document.getElementById('voice-status');
            
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                statusEl.className = 'success';
                statusEl.textContent = 'Voice Recognition is supported';
                log('Voice Recognition API available', 'success');
                
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                
                recognition.onstart = () => {
                    log('Voice recognition started - say something!', 'success');
                    statusEl.textContent = 'Listening... Say something!';
                };
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    log(`Heard: "${transcript}"`, 'success');
                    statusEl.textContent = `Heard: "${transcript}"`;
                };
                
                recognition.onerror = (event) => {
                    log(`Voice error: ${event.error}`, 'error');
                    statusEl.className = 'error';
                    statusEl.textContent = `Error: ${event.error}`;
                };
                
                recognition.start();
                
            } else {
                statusEl.className = 'error';
                statusEl.textContent = 'Voice Recognition not supported';
                log('Voice Recognition not supported in this browser', 'error');
            }
        }
        
        function testSpeechSynthesis() {
            if ('speechSynthesis' in window) {
                log('Testing speech synthesis...', 'info');
                
                const utterance = new SpeechSynthesisUtterance('Flash AI systems online. Voice test successful.');
                utterance.rate = 0.95;
                utterance.pitch = 0.85;
                utterance.volume = 0.9;
                
                const voices = speechSynthesis.getVoices();
                log(`Available voices: ${voices.length}`, 'info');
                
                // Try to find a British voice
                const britishVoice = voices.find(voice => 
                    voice.lang.includes('en-GB') || 
                    voice.name.includes('Daniel') ||
                    voice.name.includes('UK')
                );
                
                if (britishVoice) {
                    utterance.voice = britishVoice;
                    log(`Using voice: ${britishVoice.name}`, 'success');
                }
                
                speechSynthesis.speak(utterance);
                
            } else {
                log('Speech synthesis not supported', 'error');
            }
        }
        
        async function testGroqAPI() {
            const statusEl = document.getElementById('groq-status');
            const apiKey = localStorage.getItem('GROQ_API_KEY');
            
            if (!apiKey || apiKey === 'YOUR_GROQ_API_KEY_HERE') {
                statusEl.className = 'error';
                statusEl.textContent = 'Please set API key first';
                log('Cannot test Groq API without key', 'error');
                return;
            }
            
            statusEl.textContent = 'Testing Groq API...';
            log('Sending test request to Groq...', 'info');
            
            try {
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'mixtral-8x7b-32768',
                        messages: [
                            {
                                role: "system",
                                content: "You are Flash, a JARVIS-style AI assistant. Respond in a brief, sophisticated manner."
                            },
                            {
                                role: "user",
                                content: "Hello Flash, are you online?"
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 100
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const aiResponse = data.choices[0].message.content;
                    
                    statusEl.className = 'success';
                    statusEl.textContent = `API Working! Flash says: "${aiResponse}"`;
                    log(`Groq API test successful: "${aiResponse}"`, 'success');
                    
                    // Speak the response
                    if ('speechSynthesis' in window) {
                        const utterance = new SpeechSynthesisUtterance(aiResponse);
                        utterance.rate = 0.95;
                        utterance.pitch = 0.85;
                        speechSynthesis.speak(utterance);
                    }
                    
                } else {
                    const error = await response.text();
                    statusEl.className = 'error';
                    statusEl.textContent = `API Error: ${response.status}`;
                    log(`Groq API error: ${error}`, 'error');
                }
                
            } catch (error) {
                statusEl.className = 'error';
                statusEl.textContent = `Error: ${error.message}`;
                log(`Test failed: ${error.message}`, 'error');
            }
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
            log('Log cleared');
        }
        
        // Initial checks
        window.onload = () => {
            log('Test page loaded');
            checkAPIKey();
            
            // Check if voices are loaded
            if (speechSynthesis.getVoices().length === 0) {
                speechSynthesis.addEventListener('voiceschanged', () => {
                    log(`Voices loaded: ${speechSynthesis.getVoices().length} available`, 'success');
                });
            }
        };
    </script>
</body>
</html>