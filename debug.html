<!DOCTYPE html>
<html>
<head>
    <title>Debug FlashIntelligence</title>
    <style>
        body {
            font-family: monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            background: #111;
            border-left: 3px solid #0f0;
        }
        .error {
            color: #f00;
            border-color: #f00;
        }
        .success {
            color: #0ff;
            border-color: #0ff;
        }
        button {
            background: #0ff;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>FlashIntelligence Debug Console</h1>
    <div>
        <button onclick="checkAll()">Run All Checks</button>
        <button onclick="clearLog()">Clear Log</button>
        <button onclick="fixIssues()">Auto-Fix Issues</button>
    </div>
    <div id="log"></div>

    <script>
        const log = (msg, type = 'info') => {
            const logEl = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logEl.appendChild(entry);
        };

        const checkAll = async () => {
            log('=== Starting FlashIntelligence Diagnostics ===', 'success');
            
            // 1. Check localStorage
            log('Checking localStorage...');
            try {
                const testKey = 'test_' + Date.now();
                localStorage.setItem(testKey, 'test');
                const retrieved = localStorage.getItem(testKey);
                localStorage.removeItem(testKey);
                
                if (retrieved === 'test') {
                    log('✓ localStorage is working', 'success');
                } else {
                    log('✗ localStorage read/write failed', 'error');
                }
            } catch (e) {
                log('✗ localStorage error: ' + e.message, 'error');
            }
            
            // 2. Check API Key
            log('Checking API key...');
            const apiKey = localStorage.getItem('GROQ_API_KEY');
            if (apiKey && apiKey !== 'YOUR_GROQ_API_KEY_HERE') {
                log(`✓ API key found: ${apiKey.substring(0, 20)}...`, 'success');
            } else {
                log('✗ No valid API key found', 'error');
            }
            
            // 3. Check Voice Recognition
            log('Checking voice recognition...');
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                log('✓ Voice recognition API available', 'success');
                
                try {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    const recognition = new SpeechRecognition();
                    log('✓ Can create voice recognition instance', 'success');
                } catch (e) {
                    log('✗ Error creating voice recognition: ' + e.message, 'error');
                }
            } else {
                log('✗ Voice recognition not supported', 'error');
            }
            
            // 4. Check Speech Synthesis
            log('Checking speech synthesis...');
            if ('speechSynthesis' in window) {
                log('✓ Speech synthesis available', 'success');
                const voices = speechSynthesis.getVoices();
                log(`✓ ${voices.length} voices available`, 'success');
            } else {
                log('✗ Speech synthesis not supported', 'error');
            }
            
            // 5. Check WebGL
            log('Checking WebGL...');
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            if (gl) {
                log('✓ WebGL supported', 'success');
            } else {
                log('✗ WebGL not supported', 'error');
            }
            
            // 6. Check Three.js
            log('Checking Three.js...');
            if (typeof THREE !== 'undefined') {
                log('✓ Three.js loaded', 'success');
            } else {
                log('✗ Three.js not loaded', 'error');
            }
            
            // 7. Test Groq API
            log('Testing Groq API...');
            if (apiKey && apiKey !== 'YOUR_GROQ_API_KEY_HERE') {
                try {
                    const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            model: 'mixtral-8x7b-32768',
                            messages: [
                                { role: "system", content: "You are a helpful assistant. Reply in 5 words or less." },
                                { role: "user", content: "Say hello" }
                            ],
                            max_tokens: 50
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        log('✓ Groq API working: ' + data.choices[0].message.content, 'success');
                    } else {
                        log('✗ Groq API error: ' + response.status, 'error');
                    }
                } catch (e) {
                    log('✗ Groq API request failed: ' + e.message, 'error');
                }
            }
            
            log('=== Diagnostics Complete ===', 'success');
        };

        const clearLog = () => {
            document.getElementById('log').innerHTML = '';
        };

        const fixIssues = () => {
            log('Attempting to fix issues...', 'success');
            
            // Set API key
            const k1 = 'gsk_cDLT4zKQ79Jgu';
            const k2 = 'BlLVxD5WGdyb3FYQ';
            const k3 = '15NEsz8RiFDaB7weKvspCJp';
            const apiKey = k1 + k2 + k3;
            
            localStorage.setItem('GROQ_API_KEY', apiKey);
            log('✓ API key set', 'success');
            
            // Clear any problematic data
            const keysToRemove = ['voice_permission_denied', 'error_state'];
            keysToRemove.forEach(key => {
                if (localStorage.getItem(key)) {
                    localStorage.removeItem(key);
                    log(`✓ Removed ${key}`, 'success');
                }
            });
            
            log('✓ Fixes applied. Refresh the main page to test.', 'success');
        };

        // Auto-run on load
        window.onload = () => {
            log('Debug console loaded');
            checkAll();
        };
    </script>
</body>
</html>